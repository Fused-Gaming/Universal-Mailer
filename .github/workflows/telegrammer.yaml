name: Telegram Notifications

on:
  push:
    branches: [ main ]
  release:
    types: [published]
  workflow_run:
    workflows: ["CI - Continuous Integration"]
    types: [completed]

jobs:
  notify:
    name: Send Telegram Notification
    runs-on: ubuntu-latest
    steps:
      - name: Send notification on push
        if: github.event_name == 'push'
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          format: markdown
          message: |
            üöÄ *New Commit Pushed*

            *Repository:* `${{ github.repository }}`
            *Branch:* `${{ github.ref_name }}`
            *Author:* ${{ github.event.head_commit.author.name }}

            *Commit Message:*
            ```
            ${{ github.event.head_commit.message }}
            ```

            [View Commit](${{ github.event.head_commit.url }})

      - name: Send notification on release
        if: github.event_name == 'release'
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          format: markdown
          message: |
            üéâ *New Release Published*

            *Version:* `${{ github.event.release.tag_name }}`
            *Name:* ${{ github.event.release.name }}
            *Author:* ${{ github.event.release.author.login }}

            *Release Notes:*
            ${{ github.event.release.body }}

            [Download Release](${{ github.event.release.html_url }})

      - name: Send notification on CI completion
        if: github.event_name == 'workflow_run'
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          format: markdown
          message: |
            ${{ github.event.workflow_run.conclusion == 'success' && '‚úÖ CI Tests Passed' || '‚ùå CI Tests Failed' }}

            *Repository:* `${{ github.repository }}`
            *Workflow:* ${{ github.event.workflow_run.name }}
            *Status:* ${{ github.event.workflow_run.conclusion }}

            [View Workflow Run](${{ github.event.workflow_run.html_url }})
